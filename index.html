<!--
  WhaleSwap - Decentralized Trading Interface
  A single-page application for creating and managing peer-to-peer token swaps.
  Features: wallet connection, token swapping, order management, and dark/light themes.
-->
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <!-- Head section contains meta info, styles, and script imports -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WhaleSwap</title>
    <!-- Favicon using the same logo -->
    <link rel="icon" type="image/png" href="img/whale_swap_2.webp" />
    <link rel="shortcut icon" type="image/png" href="img/whale_swap_2.webp" />
    <!-- Normalize.css for consistent styling across browsers -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <!-- Core styles -->
    <link rel="stylesheet" href="css/styles.css" />
    <!-- Component-specific styles -->
    <link rel="stylesheet" href="css/components/forms.css" />
    <link rel="stylesheet" href="css/components/orders.css" />
    <link rel="stylesheet" href="css/components/tabs.css" />
    <link rel="stylesheet" href="css/components/wallet.css" />
    <link rel="stylesheet" href="css/components/cleanup.css" />
    <link rel="stylesheet" href="css/components/contract-params.css" />
    <link rel="stylesheet" href="css/components/debug.css" />
    <link rel="stylesheet" href="css/components/toast.css" />
    <link rel="stylesheet" href="css/components/footer.css" />
    <!-- Import map for ethers.js library -->
    <script type="importmap">
      {
        "imports": {
          "ethers": "https://unpkg.com/ethers@5.7.2/dist/ethers.esm.min.js"
        }
      }
    </script>
    <!-- Bootstrap loader styles (inline so loader appears immediately, even on slow networks) -->
    <style>
      #app-bootstrap-loader {
        position: fixed;
        inset: 0;
        z-index: 99999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
        color: #1a1a1a;
        opacity: 1;
        padding: 20px;
        text-align: center;
      }

      #app-bootstrap-loader .loading-skeleton--app {
        width: min(1320px, calc(100vw - 40px));
        display: flex;
        flex-direction: column;
        gap: 18px;
        margin-bottom: 12px;
      }

      #app-bootstrap-loader .skeleton-block {
        border-radius: 12px;
        background: linear-gradient(90deg, #e2e7ef 25%, #f2f5fa 50%, #e2e7ef 75%);
        background-size: 200% 100%;
        animation: bootstrap-shimmer 3s ease-in-out infinite;
      }

      #app-bootstrap-loader .skeleton-app-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        min-height: 108px;
        padding: 20px 24px;
        border-radius: 16px;
        background: rgba(220, 226, 236, 0.72);
      }

      #app-bootstrap-loader .skeleton-app-brand {
        display: flex;
        align-items: center;
        gap: 14px;
      }

      #app-bootstrap-loader .skeleton-app-logo {
        width: 74px;
        height: 74px;
        border-radius: 999px;
      }

      #app-bootstrap-loader .skeleton-app-brand-lines {
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: min(360px, 44vw);
      }

      #app-bootstrap-loader .skeleton-app-title {
        height: 32px;
        width: 86%;
      }

      #app-bootstrap-loader .skeleton-app-version {
        height: 16px;
        width: 28%;
      }

      #app-bootstrap-loader .skeleton-app-wallet {
        display: flex;
        align-items: center;
        gap: 14px;
      }

      #app-bootstrap-loader .skeleton-app-pill {
        height: 48px;
        border-radius: 14px;
      }

      #app-bootstrap-loader .skeleton-app-pill--network {
        width: 220px;
      }

      #app-bootstrap-loader .skeleton-app-pill--account {
        width: 188px;
      }

      #app-bootstrap-loader .skeleton-app-shell {
        min-height: min(760px, 74vh);
        border-radius: 18px;
        background: rgba(220, 226, 236, 0.72);
        padding: 18px 22px 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      #app-bootstrap-loader .skeleton-app-tabs-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }

      #app-bootstrap-loader .skeleton-app-tab {
        height: 28px;
        border-radius: 8px;
      }

      #app-bootstrap-loader .skeleton-app-tab--sm {
        width: 72px;
      }

      #app-bootstrap-loader .skeleton-app-tab--md {
        width: 106px;
      }

      #app-bootstrap-loader .skeleton-app-divider {
        height: 2px;
        width: 100%;
        border-radius: 2px;
      }

      #app-bootstrap-loader .skeleton-app-main {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 8px;
      }

      #app-bootstrap-loader .skeleton-app-form {
        width: min(560px, 94%);
        border-radius: 20px;
        background: rgba(220, 226, 236, 0.72);
        padding: 22px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      #app-bootstrap-loader .skeleton-app-token {
        height: 146px;
        border-radius: 14px;
      }

      #app-bootstrap-loader .skeleton-app-arrow {
        width: 34px;
        height: 34px;
        border-radius: 999px;
        align-self: center;
      }

      #app-bootstrap-loader .skeleton-app-line {
        height: 58px;
        border-radius: 12px;
      }

      #app-bootstrap-loader .skeleton-app-line--short {
        height: 72px;
      }

      #app-bootstrap-loader .skeleton-app-button {
        height: 56px;
        border-radius: 14px;
        margin-top: 8px;
      }

      #app-bootstrap-loader .skeleton-app-footer {
        height: 2px;
        width: 100%;
        border-radius: 2px;
      }

      #app-bootstrap-loader .loading-text {
        font-size: 14px;
        font-weight: 500;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
      }

      #app-bootstrap-loader .loading-hint {
        position: absolute;
        top: calc(50% + 20px);
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: #5c6474;
        width: min(540px, 92vw);
      }

      #app-bootstrap-loader .loading-retry {
        position: absolute;
        top: calc(50% + 50px);
        left: 50%;
        transform: translateX(-50%);
        border: 1px solid #c7cfdd;
        background: #ffffff;
        color: #1a1a1a;
        border-radius: 8px;
        padding: 6px 10px;
        cursor: pointer;
        font-size: 12px;
      }

      #app-bootstrap-loader .loading-retry:hover {
        background: #f2f5fb;
      }

      #app-bootstrap-loader.is-slow .loading-text {
        color: #3a4cbf;
      }

      @keyframes bootstrap-shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        #app-bootstrap-loader .skeleton-block {
          animation: none;
          background-position: 50% 0;
        }
      }

      @media (max-width: 720px) {
        #app-bootstrap-loader .loading-skeleton--app {
          width: min(1320px, calc(100vw - 24px));
        }
        #app-bootstrap-loader .skeleton-app-header {
          min-height: 88px;
          padding: 14px;
          flex-wrap: wrap;
          justify-content: center;
        }
        #app-bootstrap-loader .skeleton-app-logo {
          width: 56px;
          height: 56px;
        }
        #app-bootstrap-loader .skeleton-app-brand-lines {
          width: min(280px, 68vw);
        }
        #app-bootstrap-loader .skeleton-app-title {
          height: 24px;
        }
        #app-bootstrap-loader .skeleton-app-version {
          width: 40%;
        }
        #app-bootstrap-loader .skeleton-app-wallet {
          width: 100%;
          justify-content: center;
          gap: 10px;
        }
        #app-bootstrap-loader .skeleton-app-pill--network {
          width: min(220px, 58vw);
        }
        #app-bootstrap-loader .skeleton-app-pill--account {
          width: min(170px, 38vw);
        }
        #app-bootstrap-loader .skeleton-app-shell {
          min-height: min(700px, 76vh);
          padding: 14px;
        }
        #app-bootstrap-loader .skeleton-app-tab {
          height: 24px;
        }
        #app-bootstrap-loader .skeleton-app-tab--sm {
          width: 60px;
        }
        #app-bootstrap-loader .skeleton-app-tab--md {
          width: 86px;
        }
        #app-bootstrap-loader .skeleton-app-form {
          width: 100%;
          padding: 14px;
          gap: 10px;
        }
        #app-bootstrap-loader .skeleton-app-token {
          height: 112px;
        }
        #app-bootstrap-loader .skeleton-app-line {
          height: 50px;
        }
        #app-bootstrap-loader .skeleton-app-line--short {
          height: 62px;
        }
        #app-bootstrap-loader .skeleton-app-button {
          height: 50px;
        }
      }
    </style>
    <script>
      (function () {
        var SLOW_BOOT_THRESHOLD_MS = 12000;
        window.__bootstrapLoaderTimeout = null;

        function markSlowBoot() {
          var loader = document.getElementById('app-bootstrap-loader');
          if (!loader) return;
          loader.classList.add('is-slow');

          var text = loader.querySelector('.loading-text');
          if (text) {
            text.textContent = 'Still loading WhaleSwap...';
          }

          var hint = loader.querySelector('[data-loader-hint]');
          if (hint) {
            hint.hidden = false;
          }

          var retry = loader.querySelector('[data-loader-retry]');
          if (retry) {
            retry.hidden = false;
          }
        }

        window.addEventListener('DOMContentLoaded', function () {
          var retryButton = document.querySelector('[data-loader-retry]');
          if (retryButton) {
            retryButton.addEventListener('click', function () {
              window.location.reload();
            });
          }
          window.__bootstrapLoaderTimeout = window.setTimeout(markSlowBoot, SLOW_BOOT_THRESHOLD_MS);
        });
      })();
    </script>
    <!-- Main application entry point -->
    <script type="module" src="js/app.js" defer></script>
  </head>
  <!-- Body contains the main application structure -->
  <body>
    <div
      id="app-bootstrap-loader"
      class="loading-overlay--global"
      role="status"
      aria-live="polite"
      aria-label="Application loading"
    >
      <div class="loading-skeleton loading-skeleton--app" aria-hidden="true">
        <div class="skeleton-app-header">
          <div class="skeleton-app-brand">
            <div class="skeleton-block skeleton-app-logo"></div>
            <div class="skeleton-app-brand-lines">
              <div class="skeleton-block skeleton-app-title"></div>
              <div class="skeleton-block skeleton-app-version"></div>
            </div>
          </div>
          <div class="skeleton-app-wallet">
            <div class="skeleton-block skeleton-app-pill skeleton-app-pill--network"></div>
            <div class="skeleton-block skeleton-app-pill skeleton-app-pill--account"></div>
          </div>
        </div>
        <div class="skeleton-app-shell">
          <div class="skeleton-app-tabs-row">
            <div class="skeleton-block skeleton-app-tab skeleton-app-tab--sm"></div>
            <div class="skeleton-block skeleton-app-tab skeleton-app-tab--md"></div>
            <div class="skeleton-block skeleton-app-tab skeleton-app-tab--md"></div>
            <div class="skeleton-block skeleton-app-tab skeleton-app-tab--md"></div>
            <div class="skeleton-block skeleton-app-tab skeleton-app-tab--md"></div>
            <div class="skeleton-block skeleton-app-tab skeleton-app-tab--sm"></div>
            <div class="skeleton-block skeleton-app-tab skeleton-app-tab--sm"></div>
          </div>
          <div class="skeleton-block skeleton-app-divider"></div>
          <div class="skeleton-app-main">
            <div class="skeleton-app-form">
              <div class="skeleton-block skeleton-app-token"></div>
              <div class="skeleton-block skeleton-app-arrow"></div>
              <div class="skeleton-block skeleton-app-token"></div>
              <div class="skeleton-block skeleton-app-line"></div>
              <div class="skeleton-block skeleton-app-line skeleton-app-line--short"></div>
              <div class="skeleton-block skeleton-app-button"></div>
            </div>
          </div>
          <div class="skeleton-block skeleton-app-footer"></div>
        </div>
      </div>
      <div class="loading-text">Loading WhaleSwap...</div>
      <div class="loading-hint" data-loader-hint hidden>
        This is taking longer than expected. Your network may be slow.
      </div>
      <button class="loading-retry" type="button" data-loader-retry hidden>
        Reload Page
      </button>
    </div>
    <div class="container">
      <!-- Header contains branding, theme toggle, and wallet connection -->
      <header class="header card">
        <div class="header-left">
          <div class="logo-container">
            <img src="img/whale_swap_2.webp" alt="WhaleSwap Logo" class="logo-image" />
            <h1>WhaleSwap</h1>
            <span class="version">v1.0.37</span>
          </div>
        </div>
        <!-- Theme toggle and wallet connection controls -->
        <div class="header-right">
          <!-- Wallet connection and network selection -->
          <div id="wallet-container" class="wallet-container">
            <!-- Network dropdown selector -->
            <div class="network-selector">
              <button class="network-button">
                <span class="network-badge">Polygon</span>
                <svg
                  class="chevron-down"
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                >
                  <path
                    d="M6 9l6 6 6-6"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <!-- Network options populated dynamically -->
              <div class="network-dropdown hidden"></div>
            </div>
            <!-- Connect wallet button -->
            <button id="walletConnect" class="wallet-button">
              <span class="wallet-button-text">Connect Wallet</span>
            </button>
            <!-- Wallet info shown when connected -->
            <div id="walletInfo" class="wallet-info hidden">
              <span id="accountAddress" class="account-address"></span>
            </div>
          </div>
        </div>
      </header>
      <div id="wallet-popup-container"></div>
      <!-- Debug panel for development (hidden by default) -->
      <div class="debug-panel" style="display: none">
        <!-- Debug controls and options -->
        <div class="debug-controls">
          <div class="debug-header">
            <h3>Debug Settings</h3>
            <div class="debug-header-actions">
              <button id="selectAllDebug" class="select-all-button">
                Select All
              </button>
              <button
                id="closeDebug"
                class="close-button"
                aria-label="Close debug panel"
              >
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                >
                  <path
                    d="M18 6L6 18M6 6l12 12"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div class="debug-options">
            <div class="debug-column">
              <h4>Core</h4>
              <label class="debug-option">
                <input type="checkbox" data-debug="APP" />
                <span>App</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="WEBSOCKET" />
                <span>WebSocket</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="WALLET" />
                <span>Wallet</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="WALLET_UI" />
                <span>Wallet UI</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="BASE_COMPONENT" />
                <span>Base Component</span>
              </label>
            </div>

            <div class="debug-column">
              <h4>Orders</h4>
              <label class="debug-option">
                <input type="checkbox" data-debug="VIEW_ORDERS" />
                <span>View Orders</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="CREATE_ORDER" />
                <span>Create Order</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="MY_ORDERS" />
                <span>My Orders</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="TAKER_ORDERS" />
                <span>Taker Orders</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="CLEANUP_ORDERS" />
                <span>Cleanup Orders</span>
              </label>
            </div>

            <div class="debug-column">
              <h4>Other</h4>
              <label class="debug-option">
                <input type="checkbox" data-debug="PRICING" />
                <span>Pricing</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="TOKENS" />
                <span>Tokens</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="PRICING_DEFAULT_TO_ONE" />
                <span>Default Missing Prices to 1</span>
              </label>
              <label class="debug-option">
                <input type="checkbox" data-debug="LIBERDUS_VALIDATION" />
                <span>WhaleSwap Token Validation</span>
              </label>
            </div>
          </div>
          <div class="debug-footer">
            <button id="applyDebug" class="apply-button">Apply Changes</button>
          </div>
        </div>
      </div>
      <!-- Main application content area -->
      <main class="main-content">
        <div class="content-wrapper card">
          <!-- Navigation tabs for different sections -->
          <nav class="nav-tabs">
            <button class="tab-button" data-tab="intro" style="display: block">
              Intro
            </button>
            <button
              class="tab-button active"
              data-tab="create-order"
              style="display: none"
            >
              Create Order
            </button>
            <button
              class="tab-button"
              data-tab="view-orders"
              style="display: none"
            >
              View Orders
            </button>
            <button
              class="tab-button"
              data-tab="my-orders"
              style="display: none"
            >
              My Orders
            </button>
            <button
              class="tab-button"
              data-tab="taker-orders"
              style="display: none"
            >
              Invited Orders
            </button>
            <button
              class="tab-button"
              data-tab="cleanup-orders"
              style="display: none"
            >
              Cleanup
            </button>
            <button
              class="tab-button"
              data-tab="contract-params"
              style="display: none"
            >
              Parameters
            </button>
            <button
              class="tab-button"
              data-tab="admin"
              style="display: none"
            >
              Admin
            </button>
          </nav>

          <!-- Create Order tab content -->
          <div id="create-order" class="tab-content active card">
            <!-- Content will be rendered by CreateOrder component -->
          </div>
          <!-- Other tab contents (populated dynamically) -->
          <div id="intro" class="tab-content card"></div>
          <div id="view-orders" class="tab-content card"></div>
          <div id="my-orders" class="tab-content card"></div>
          <div id="taker-orders" class="tab-content card"></div>
          <div id="cleanup-orders" class="tab-content card">
            <div id="cleanup-container" class="cleanup-container"></div>
          </div>
          <div id="contract-params" class="tab-content card">
            <div
              id="contract-params-container"
              class="contract-params-container"
            ></div>
          </div>
          <div id="admin" class="tab-content card"></div>
          <div id="app-footer" class="app-footer"></div>
        </div>
      </main>
    </div>
  </body>
</html>
